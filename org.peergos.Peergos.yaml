app-id: org.peergos.Peergos
runtime: org.gnome.Platform
runtime-version: "46"

sdk: org.freedesktop.Sdk//23.08

sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk21

command: peergos

finish-args:
  - --share=network

  - --socket=x11
  - --socket=wayland

build-options:
  append-path: /usr/lib/sdk/openjdk21/bin
  env:
    JAVA_HOME: /usr/lib/sdk/openjdk21

modules:
  - name: ant
    buildsystem: simple
    build-commands:
      - ./build.sh
      - mkdir -p /app/ant
      - mkdir -p /app/bin
      - cp -r dist /app/ant
      - ln -s /app/ant/bin/ant /app/bin/ant
    sources:
      - type: archive
        url: https://downloads.apache.org/ant/source/apache-ant-1.10.14-src.tar.gz
        sha256: 9a5fe31f44d1eb62590cbe38e4fab25b25e2f68643b38a54b66498e0bf621b54

  - name: peergos
    buildsystem: simple
    build-commands:
      - which java
      - export JAVA_HOME=/app/jdk
      - export PATH=$JAVA_HOME/bin:$PATH/app/jdk

      - ant dist

      - install -Dm644 server/Peergos.jar /app/share/peergos/Peergos.jar

      - install -Dm755 peergos.sh /app/bin/peergos

      - install -Dm644 org.peergos.Peergos.desktop /app/share/applications/org.peergos.Peergos.desktop

      - install -Dm644 peergos.svg /app/share/icons/hicolor/256x256/apps/org.peergos.Peergos.svg

      - install -Dm644 org.peergos.Peergos.metainfo.xml /app/share/metainfo/org.peergos.Peergos.metainfo.xml

    sources:
      - type: git
        url: http://github.com/peergos/web-ui.git
        branch: master

      - type: file
        path: peergos.sh

      - type: file
        path: org.peergos.Peergos.desktop

      - type: file
        path: peergos.svg

      - type: file
        path: org.peergos.Peergos.metainfo.xml

